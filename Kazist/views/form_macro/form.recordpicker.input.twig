{% macro input(name, type, default, label, class, id, attributes, readonly, options, setting, context) %}

    {% import "form.macro.twig" as forms %}
    {{ set_assets('assets/js/recordpicker.js') }}

    {% set edit_index = get_context('edit_index') %}
    {% set user = getSessionItem('user') %}

    {% set style_params = 'style="display: none;"' %}
    {% set checkbox_params = '' %}
    {% set user_form_name = 'form[' ~ name ~ ']' %}

    {% if attribute(edit_index, name) != '' %}
        {% set checkbox_params = 'checked' %}
        {% set style_params = '' %}
        {% set user_form_name = '' %}
    {% endif%}

    <div class="form-group {{ classname(class, name, false) }}-group">
        <label for="{{ name }}" class="col-sm-3 control-label">{{ label }}</label>
        <div class="col-sm-9 kazicode-form-field {{name}}_recordpicker {% if readonly %}form-control-static{% endif %}">
            <div class="col-sm-6 recordpicker_detail">
                <span class="recordpicker_text">{{ attribute(edit_index, name~'_join')|default('Select Record.') }}</span>
                <input class="recordpicker_value" type="hidden" name="form[{{ name }}]" value="{{ attribute(edit_index, name) }}">
            </div>
            <div class="col-sm-6">
                {% if not readonly %}
                    <a class="btn btn-primary btn-xs add-recordpicker" href="#" data-toggle="modal" data-target="#recordpicker{{ name }}Modal" field_name="{{ name }}" title="Choose Record">Choose Record</a>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="modal fade large form-horizontal" id="recordpicker{{ name }}Modal" tabindex="-1" role="dialog" aria-labelledby="recordpicker{{ name }}ModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="subsetModalLabel">Choose Record</h4>
                </div>
                <div class="modal-body">
                    <iframe src="{{generate_url('' ~ setting.parameters.source.app_name ~ '.' ~ setting.parameters.source.com_name ~ '.' ~ setting.parameters.source.subset_name ~ '&twig=recordpicker&displayfield=' ~ setting.parameters.source.display_field|join(',')) }}" style="width:100%;height: 500px;" scrolling="yes">

                    </iframe>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">
                        Close
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>       

    <style>
        #recordpicker{{ name }}Modal .modal-dialog {
            width: 90% !important;
        }
    </style>

{% endmacro %}

